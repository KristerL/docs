---
id: overview
title: Preview Overview
---

import { Image } from '@site/src/components/image';
import overviewScreenshotImg from './overview_screenshot.png'
import dependenciesImg from './dependencies.png'
import dependenciesLinkFileImg from './dependencies_link_file.png'
import fetchPreviewsImg from './fetch_previews.png'

The Preview Aspect enables component visualizations to be displayed by the browser. Component visualizations include the component compositions and documentation, but may also include other custom component previews.

Preview assists other Aspects by providing them with an API to bundle and display their component visualizations.

Component previewing is done in an isolated [Preview environment](#preview-runtime--environment) that is rendered inside an iframe, in Bit's UI.

For example, the following screenshot shows a preview (a component's 'Overview') rendered in a preview environment and displayed in an iframe.

<Image src={overviewScreenshotImg} />

## Preview runtime

The preview runtime is, essentially, an application, isolated from Bit's UI, and integrated into it using an iframe. This application uses an Env's specific configurations to bundle and render its components' visualizations.
That gives you the freedom to render any component preview, regardless of the set of technologies used to implement it.

<Image src={fetchPreviewsImg} />

## Previewing components in development

When running `bit start` the Preview aspect runs the dev servers that are needed to bundle and serve component visualizations.

The DevServer Aspect is used to provide an optimized dev experience. Artifacts are generated without minimization, for better bundling performance and for easily debbugable code.
Moreover, the DevServer is configured, by default, to use webpack-server with Hot Module Replacement, to provide quick page updates and persisted states (webpack-server is provided by the Webpack Aspect).

Since component previews are bundled using the DevServer, the number of running dev servers is determined by the number of different DevServer configurations, set by the various Envs.
For performance optimization, Envs that use identical DevServer configs will share a single DevServer.

The example below shows 2 servers running, the UI server and the Preview DevServer.

```bash
ENVIRONMENT NAME                    URL                                  STATUS
teambit.harmony/aspect on behalf    http://localhost:3300                RUNNING
of teambit.harmony/aspect,
company.scope/envs/my-react


You can now view 'my-workspace' components in the browser.
Bit server is running on http://localhost:3000
```

## Building the component previews

The Preview Aspect registers its own Build Task to generate preview artifacts during build time. This build task uses the Bundler (and not the DevServer) to generate minimized assets, for optimized page loads.

```bash
$ bit build ui/text

✔ env "company.scope/envs/my-react", task "teambit.preview/preview:GeneratePreview" has completed successfully in 39s
✔ env "teambit.harmony/aspect", task "teambit.preview/preview:GeneratePreview" has completed successfully in 25s
```

Artifacts that are generated as part of the `snap` or `tag` pipelines, will be persisted in the component objects, and will later be loaded by the Workspace/Scope UI.

For example:

```bash
# run tag
$ bit tag ui/text

# list the component artifacts
$ bit artifacts ui/text
# ...
  teambit.preview/preview
    GeneratePreview
      public/asset-manifest.json
      public/index.html
      public/service-worker.js
      public/workbox-4979716c.js
      public/static/css/173.00004871.css
      public/static/css/main.e10f3a52.css
      public/static/js/173.67a47fd6.js
      public/static/js/173.67a47fd6.js.LICENSE.txt
      public/static/js/main.8f2d7ca0.js
      public/static/js/runtime-main.f8aedb2c.js
```

## Link files

A link file is a pseudo entry file that requires all the modules (component files and a template) of a specific preview. It is generated by the Preview Aspect and served to the bundler.

Bundlers process and concatenate modules of an application by crawling over a network of dependencies that starts from the app's entry file.

Components are not all dependencies (direct or indirect) of a single entry file. They do not provide the bundler with a single network of modules to process.

<Image src={dependenciesImg} width="90%" />

To solve that, the Preview aspect requires all the modules of a single preview into a single link file, named using a timestamp and prefixed by the preview name. For example: `__overview-1633481243984.js`.

<Image src={dependenciesLinkFileImg} width="70%"/>

Link files generated in development are placed in the `node_modules/.cache/bit/teambit.preview/preview/{env-id}/` directory (inside the workspace).

Link files generated for distribution, as part of the build process, are placed in the capsule, under the `{env-id}_{env-name}-preview` directory.

```ts title="__overview-1633481243984.js"
import { linkModules } from '/Users/user/.config/yarn/global/node_modules/@teambit/preview/dist/preview.preview.runtime.js';
import harmony from '/Users/user/.config/yarn/global/node_modules/@teambit/harmony/dist/index.js';
const defaultModule = require('/Users/user/.config/yarn/global/node_modules/@teambit/react/dist/docs/index.js');
linkModules('overview', defaultModule, {
  'ui/card': [
    require('/Users/user/Library/Caches/Bit/capsules/e5e3c066720abd3391b917ed141cc7c7163b17ce/company.demo_ui_card_@1.0.1/dist/card.docs.mdx'),
  ],
  'ui/heading': [
    require('/Users/user/Library/Caches/Bit/capsules/e5e3c066720abd3391b917ed141cc7c7163b17ce/company.demo_ui_heading@0.0.1/dist/heading.docs.mdx'),
  ],
  'ui/text': [
    require('/Users/user/Library/Caches/Bit/capsules/e5e3c066720abd3391b917ed141cc7c7163b17ce/company.demo_ui_text@1.0.1/dist/text.docs.mdx'),
  ],
  'pages/welcome': [
    require('/Users/user/Library/Caches/Bit/capsules/e5e3c066720abd3391b917ed141cc7c7163b17ce/company.demo_pages_welcome@1.0.0/dist/welcome.docs.mdx'),
  ],
});
```

:::info linkModules
The `linkModules` function generates an object with mapped preview modules. This object is used by the Preview aspect to render specific previews for specific components.

:::
